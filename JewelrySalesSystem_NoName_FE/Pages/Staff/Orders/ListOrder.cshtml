@page
@model JewelrySalesSystem_NoName_FE.Pages.Staff.Orders.ListOrderModel
@{
    ViewData["Title"] = "Search Jewelry Orders";
}

<div class="main-panel">
    <div class="content-wrapper">
        <div class="page-header d-flex justify-content-between align-items-center">
            <div>
                <h1 class="page-title display-4">DANH SÁCH ĐƠN HÀNG</h1>
            </div>
        </div>

        <form method="get" class="row g-3 bg-light p-4 rounded shadow-sm">
            <div class="col-md-6">
                <label for="OrderId" class="form-label">Order ID</label>
                <input type="text" class="form-control" id="OrderId" name="OrderId" value="@Model.SearchCriteria.OrderId" placeholder="Nhập ID đơn hàng" />
            </div>
            <div class="col-md-6">
                <label for="StartDate" class="form-label">Start Date</label>
                <input type="date" class="form-control" id="StartDate" name="StartDate" value="@Model.SearchCriteria.StartDate?.ToString("yyyy-MM-dd")" />
            </div>
            <div class="col-md-12 d-flex justify-content-end">
                <button type="submit" class="btn btn-gradient-secondary btn-fw mt-3">
                    <i class="mdi mdi-magnify"></i>
                    Tìm Kiếm
                </button>
            </div>
        </form>

        <br />

        <div class="col-lg-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead class="thead-dark">
                                <tr>
                                    <th>Mã</th>
                                    <th>Tổng giá trị</th>
                                    <th>Ngày mua hàng</th>
                                    <th>Xem chi tiết</th>
                                </tr>
                            </thead>
                            <tbody id="orderListBody">
                                @foreach (var order in Model.FilteredOrderList)
                                {
                                    <tr>
                                        <td>@order.Id</td>
                                        <td>@order.TotalPrice</td>
                                        <td>@order.InsDate</td>
                                        <td>
                                            <button type="button" class="btn btn-outline-primary btn-fw" onclick="fetchOrderDetails('@order.Id', '@order.ProductId')">Xem chi tiết</button>
                                        </td>
                                    </tr>
                                    <!-- Order Details Modal -->
                                    <div class="modal fade" id="orderModal-@order.Id" tabindex="-1" aria-labelledby="orderModalLabel-@order.Id" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered modal-sm">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="orderModalLabel-@order.Id">Chi tiết đơn hàng - @order.Id</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body" id="orderDetailsContent-@order.Id">
                                                    <!-- Order and product details will be inserted here -->
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        async function fetchOrderDetails(orderId, productId) {
            try {
                // Fetch order details
                const orderResponse = await fetch(`https://localhost:44318/api/v1/OrderDetail/OrderID/id?id=${orderId}`);
                const orderResult = await orderResponse.json();

                if (orderResponse.ok) {
                    const orderDetails = orderResult;

                    // Format order and product details HTML
                    const detailsHtml = `
                                    <div style="padding: 20px; font-family: Arial, sans-serif; line-height: 1.6;">
                                        <h5 style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 20px;">Thông tin đơn hàng</h5>
                                        <p><strong>Mã đơn hàng:</strong> ${orderDetails.order.id}</p>
                                        <p><strong>Mã khách hàng:</strong> ${orderDetails.order.customerId}</p>
                                        <p><strong>Ngày mua:</strong> ${orderDetails.order.insDate}</p>
                                        <p><strong>Hình thức mua:</strong> ${orderDetails.order.type}</p>
                                        <p><strong>Giá:</strong> ${orderDetails.amount}</p>
                                        <p><strong>Số lượng:</strong> ${orderDetails.quantity}</p>
                                        <p><strong>Giảm giá:</strong> ${orderDetails.discount}</p>
                                        <p><strong>Tổng giá trị:</strong> ${orderDetails.totalPrice}</p>
                                        <p><strong>Ngày mua hàng:</strong> ${new Date(orderDetails.insDate).toLocaleString()}</p>
                                        <p><strong>Mã sản phẩm:</strong> ${orderDetails.productId}</p>

                                        <h5 style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 20px; margin-top: 30px;">Chi tiết sản phẩm</h5>
                                        <p><strong>Mã sản phẩm:</strong> ${orderDetails.product.id}</p>
                                        <p><strong>Tên sản phẩm:</strong> ${orderDetails.product.productName}</p>
                                        <p><strong>Mô tả:</strong> ${orderDetails.product.description}</p>
                                        <p><strong>Kích thước:</strong> ${orderDetails.product.size}</p>
                                        <p><strong>Giá:</strong> ${orderDetails.product.sellingPrice}</p>
                                        <p><strong>Mã code:</strong> ${orderDetails.product.code}</p>
                                        <p><strong>Hình ảnh sản phẩm:</strong></p>
                                        <img src="${orderDetails.product.imgProduct}" alt="${orderDetails.product.productName}" style="max-width: 100%; height: auto; border: 1px solid #ddd; padding: 5px;">
                                    </div>
                                `;

                    // Display the details in the modal body
                    document.getElementById(`orderDetailsContent-${orderId}`).innerHTML = detailsHtml;

                    // Show the modal
                    $(`#orderModal-${orderId}`).modal('show');
                } else {
                    alert('Failed to fetch order or product details.');
                }
            } catch (error) {
                console.error('Error fetching order or product details:', error);
            }
        }
    </script>
}

<style>
    .page-title {
        font-size: 2.5rem;
    }

    .form-label {
        font-weight: bold;
        color: #495057;
    }

    .form-control {
        border-radius: 0.375rem;
    }

    .btn-gradient-secondary {
        background: linear-gradient(45deg, #6a11cb 0%, #2575fc 100%);
        border: none;
        color: white;
    }

    .bg-light {
        background-color: #f8f9fa !important;
    }

    .rounded {
        border-radius: 0.375rem !important;
    }

    .shadow-sm {
        box-shadow: 0 .125rem .25rem rgba(0, 0, 0, 0.075) !important;
    }

    .text-danger {
        font-size: 0.875rem;
    }

    .card {
        margin-bottom: 20px;
    }

    .table-responsive {
        margin-top: 20px;
    }

    .table thead th {
        background-color: #343a40;
        color: #fff;
    }

    .modal-header {
        background-color: #007bff;
        color: white;
    }

    .modal-body {
        padding: 20px;
        font-family: Arial, sans-serif;
        line-height: 1.6;
    }

        .modal-body h5 {
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .modal-body img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            padding: 5px;
            border-radius: 8px;
            margin-top: 20px;
        }

    .modal-footer {
        border-top: 1px solid #ddd;
        padding-top: 10px;
        margin-top: 20px;
    }

    .modal-dialog.modal-sm {
        max-width: 500px;
    }
</style>
