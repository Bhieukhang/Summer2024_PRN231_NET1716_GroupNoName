@page
@model JewelrySalesSystem_NoName_FE.Pages.Manager.Diamonds.ListDiamondModel
@{
    int totalPages = Model.TotalPages;
}
<div class="main-panel">
    <div class="content-wrapper">
        <div class="page-header d-flex justify-content-between align-items-center">
            <div>
                <h1 class="page-title display-4">DANH SÁCH KIM CƯƠNG</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="nav-item">
                            <a class="nav-link" href="~/Manager/Diamonds/AddDiamond">
                                <span class="menu-title"></span>
                                <button type="button" class="btn btn-gradient-primary btn-fw">
                                    <i class="mdi mdi-plus"></i>
                                    Thêm kim cương mới
                                </button>
                            </a>
                        </li>
                    </ol>
                </nav>
            </div>
        </div>

        <div class="mt-3">
            <form method="get" id="searchForm" onsubmit="searchDiamondByCode(); return false;">
                <div class="input-group">
                    <input type="text" id="searchCode" name="searchCode" class="form-control" placeholder="Nhập mã code của kim cương cần tìm"
                           autocomplete="off" onkeyup="autocompleteSearch(this.value)" />
                    <div id="autocomplete-list" class="autocomplete-items"></div>
                    <button type="submit" class="btn btn-gradient-secondary">
                        <i class="mdi mdi-magnify"></i>
                        Tìm Kiếm
                    </button>
                </div>
            </form>
        </div>
        <br/>
        <div id="resultContainer"></div>
        <div id="autocomplete-list" class="col-lg-12 grid-margin stretch-card"></div>
        <div class="col-lg-12 grid-margin stretch-card" id="uiDiamond">
            <div class="card">
                <div class="card-body" id="autocomplete-suggestion">
                    <div class="row" id="diamondList">
                        @if (Model.SearchCode == null)
                        {
                            @foreach (var item in Model.diamondList)
                            {
                                <div class="col-md-3 d-flex align-items-stretch mb-4">
                                    <div class="card diamond-card d-flex flex-column">
                                        <img class="card-img-top diamond-image" src="@item.ImageDiamond" alt="Card image cap">
                                        <div class="card-body d-flex flex-column">
                                            <h5 class="card-title">@item.DiamondName</h5>
                                            <p class="card-text">Code: <strong>@item.Code</strong></p>
                                            <p class="card-text">Trọng lượng: <strong>@item.Carat carat</strong></p>
                                            <p class="card-text">Màu sắc: <strong>@item.Color</strong></p>
                                            <p class="card-text">Độ tinh khiết: <strong>@item.Clarity</strong></p>
                                            <p class="card-text">Chất lượng cắt: <strong>@item.Cut</strong></p>
                                            <p class="card-text">Số lượng: <strong>@item.Quantity</strong></p>
                                            <p class="card-text">Giá Bán: <strong>@item.Price</strong></p>
                                            <div class="mt-auto d-flex justify-content-between">
                                                <a href="/Manager/Diamonds/EditDiamond?id=@item.Id" class="btn btn-outline-secondary btn-fw me-2">Cập Nhật</a>
                                                <a data-bs-toggle="modal" data-bs-target="#diamondModal-@item.Id" class="btn btn-outline-danger btn-fw">
                                                    <i class="fa fa-eye menu-icon"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade" id="diamondModal-@item.Id" tabindex="-1" aria-labelledby="diamondModalLabel-@item.Id" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="diamondModalLabel-@item.Id">Chi tiết kim cương</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="diamond-details">
                                                    <img src="@item.ImageDiamond" alt="Diamond Image" class="diamond-image" />
                                                    <div class="diamond-info">
                                                        <h3>@item.DiamondName</h3>
                                                        <p><strong>Code :</strong> @item.Code</p>
                                                        <p><strong>Trọng lượng :</strong> @item.Carat carat</p>
                                                        <p><strong>Màu sắc :</strong> @item.Color</p>
                                                        <p><strong>Độ tinh khiết :</strong> @item.Clarity</p>
                                                        <p><strong>Chất lượng cắt :</strong> @item.Cut</p>
                                                        <p><strong>Số lượng :</strong> @item.Quantity</p>
                                                        <p><strong>Giá Bán:</strong> @item.Price</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                                <div class="col-md-3 d-flex align-items-stretch">
                                    <div class="card diamond-card">
                                        <img class="card-img-top diamond-image" src="@Model.searchItem.ImageDiamond" alt="Card image cap">
                                        <div class="card-body d-flex flex-column">
                                            <h5 class="card-title">@Model.searchItem.DiamondName</h5>
                                            <p class="card-text">Code: <strong>@Model.searchItem.Code</strong></p>
                                            <p class="card-text">Trọng lượng: <strong>@Model.searchItem.Carat carat</strong></p>
                                            <p class="card-text">Màu sắc: <strong>@Model.searchItem.Color</strong></p>
                                            <p class="card-text">Độ tinh khiết: <strong>@Model.searchItem.Clarity</strong></p>
                                            <p class="card-text">Chất lượng cắt: <strong>@Model.searchItem.Cut</strong></p>
                                            <p class="card-text">Số lượng: <strong>@Model.searchItem.Quantity</strong></p>
                                            <p class="card-text">Giá Bán: <strong>@Model.searchItem.Price</strong></p>
                                            <div class="mt-auto d-flex justify-content-between">
                                                <a href="/Manager/Diamonds/EditDiamond?id=@Model.searchItem.Id" class="btn btn-outline-secondary btn-fw me-2">Cập Nhật</a>
                                                <a data-bs-toggle="modal" data-bs-target="#diamondModal-@Model.searchItem.Id" class="btn btn-outline-danger btn-fw">
                                                    <i class="fa fa-eye menu-icon"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <div class="modal fade" id="diamondModal-@Model.searchItem.Id" tabindex="-1" aria-labelledby="diamondModalLabel-@Model.searchItem.Id" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="diamondModalLabel-@Model.searchItem.Id">Chi tiết kim cương</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="diamond-details">
                                                <img src="@Model.searchItem.ImageDiamond" alt="Diamond Image" class="diamond-image" />
                                                <div class="diamond-info">
                                                    <h3>@Model.searchItem.DiamondName</h3>
                                                    <p><strong>Code :</strong> @Model.searchItem.Code</p>
                                                    <p><strong>Trọng lượng :</strong> @Model.searchItem.Carat carat</p>
                                                    <p><strong>Màu sắc :</strong> @Model.searchItem.Color</p>
                                                    <p><strong>Độ tinh khiết :</strong> @Model.searchItem.Clarity</p>
                                                    <p><strong>Chất lượng cắt :</strong> @Model.searchItem.Cut</p>
                                                    <p><strong>Số lượng :</strong> @Model.searchItem.Quantity</p>
                                                    <p><strong>Giá Bán:</strong> @Model.searchItem.Price</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <nav aria-label="Page navigation example" style="padding-top:50px" id="ui">
                        <ul class="pagination justify-content-end" id="pagination">
                            <li class="page-item">
                                <a class="page-link" href="javascript:void(0);" onclick="changePage('prev')" tabindex="-1">Trước</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="javascript:void(0);" onclick="changePage('next')">Sau</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        function autocompleteSearch(query) {
            console.log(query);
            if (query.length === 0) {
                document.getElementById("autocomplete-list").innerHTML = "";
                return;
            }

            fetch(`https://localhost:44318/api/v1/Diamond/autocomplete?query=${query}`)
                .then(response => response.json())
                .then(data => {
                    console.log("Data: ", data);
                    let autocompleteList = document.getElementById("autocomplete-list");
                    autocompleteList.innerHTML = "";

                    data['$values'].forEach(item => {
                        console.log("Item", item);
                        let suggestionItem = document.createElement("div");
                        suggestionItem.classList.add("autocomplete-item");

                        suggestionItem.innerHTML = `
                                                         <img class="diamond-image-search" src="${item.imageDiamond}" alt="Diamond image">
                                                         <div class="diamond-details-search">
                                                              <h5 class="diamond-name-search">${item.diamondName}</h5>
                                                              <p class="diamond-code-search">Code : <strong>${item.code}</strong></p>
                                                         </div>`;
                        suggestionItem.onclick = function () {
                            document.getElementById("searchCode").value = item.code;
                            autocompleteList.innerHTML = "";
                        };

                        autocompleteList.appendChild(suggestionItem);
                    });
                })
                .catch(error => console.error('Error fetching autocomplete data:', error));
        }

        function searchDiamondByCode() {
            let searchCode = document.getElementById('searchCode').value;
                if (searchCode) {
                    fetch(`https://localhost:44318/api/v1/Diamond/code?code=${searchCode}`)
                        .then(response => {
                            if (!response.ok) {
                                // Nếu không tìm thấy kim cương, trả về null
                                return null;
                            }
                            return response.json();
                        })
                        .then(data => {
                            updateUI(data);
                        })
                        .catch(error => console.error('Error fetching diamond data:', error));
                }
        }

        function updateUI(data) {
                const resultContainer = document.getElementById("resultContainer");
                const diamonListContainer = document.getElementById("diamondList");
                const paginationContainer = document.getElementById("pagination");
                const uiContainer = document.getElementById("ui");
                const uiDiamondContainer = document.getElementById("uiDiamond");

                // Ẩn danh sách sản phẩm
                if (diamonListContainer) {
                    diamonListContainer.style.display = 'none';
                }

                // Ẩn phân trang
                if (paginationContainer) {
                    paginationContainer.style.display = 'none';
                }
                if (uiContainer) {
                    uiContainer.style.display = 'none';
                }
                if (uiDiamondContainer) {
                    uiDiamondContainer.style.display = 'none';
                }

                resultContainer.innerHTML = '';

                if (data) {
                    const diamondInfo = `
                                          <div class="col-md-3 d-flex align-items-stretch">
                                                                <div class="card diamond-card">
                                                                    <img class="card-img-top diamond-image" src="${data.imageDiamond}" alt="Diamond image">
                                                                    <div class="card-body d-flex flex-column">
                                                                    <h5 class="card-title">${data.diamondName}</h5>
                                                                    <p class="card-text">Code: <strong>${data.code}</strong></p>
                                                                    <p class="card-text">Trọng lượng: <strong>${data.carat} carat</strong></p>
                                                                    <p class="card-text">Màu sắc: <strong>${data.color}</strong></p>
                                                                    <p class="card-text">Độ tinh khiết: <strong>${data.clarity}</strong></p>
                                                                    <p class="card-text">Chất lượng cắt: <strong>${data.cut}</strong></p>
                                                                    <p class="card-text">Số lượng: <strong>${data.quantity}</strong></p>
                                                                    <p class="card-text">Giá Bán: <strong>${data.price}</strong></p>
                                                                        <div class="mt-auto d-flex justify-content-between">
                                                                            <a href="/Manager/Diamonds/EditDiamond?id=${data.id}" class="btn btn-outline-secondary btn-fw me-2">Cập Nhật</a>
                                                                            <a data-bs-toggle="modal" data-bs-target="#diamondModal-${data.id}" class="btn btn-outline-danger btn-fw">
                                                                                <i class="fa fa-eye menu-icon"></i>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                           </div>
                                            <div class="modal fade" id="diamondModal-${data.id}" tabindex="-1" aria-labelledby="diamondModalLabel-${data.id}" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="diamondModalLabel-${data.id}">Chi tiết kim cương</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="diamond-details">
                                                            <img src="${data.imageDiamond}" alt="Diamond Image" class="diamond-image" />
                                                            <div class="diamond-info">
                                                                <h3>${data.diamondName}</h3>
                                                                <p><strong>Code :</strong> ${data.code}</p>
                                                                <p><strong>Trọng lượng :</strong> ${data.carat} carat</p>
                                                                <p><strong>Màu sắc :</strong> ${data.color}</p>
                                                                <p><strong>Độ tinh khiết :</strong> ${data.clarity}</p>
                                                                <p><strong>Chất lượng cắt :</strong> ${data.cut}</p>
                                                                <p><strong>Số lượng :</strong> ${data.quantity}</p>
                                                                <p><strong>Giá Bán:</strong> ${data.price}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                `;
                    resultContainer.innerHTML = diamondInfo;
                } else {
                    alert('Không tìm thấy sản phẩm.');
                    @*resultContainer.innerHTML = '<p>No product found.</p>';*@
                }
            }

        function fetchDiamonds(page, size) {
            fetch('https://localhost:44318/api/v1/Diamond?page=${page}&size=${size}') 
                    .then(response => response.json())
                    .then(data => {
                        console.log('API response:', data); 
                        if (Array.isArray(data)) {
                            updateDiamondList(data);
                        } else {
                            throw new Error("Invalid data format");
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching diamonds:', error);
                    });
        }

        function updateDiamondList(diamonds) {
            const diamondListContainer = document.getElementById("diamondList");
            diamondListContainer.innerHTML = "";

            diamonds.forEach(diamond => {
                const diamondCard = `
                    <div class="col-md-3 d-flex align-items-stretch mb-4">
                        <div class="card diamond-card d-flex flex-column">
                            <img class="card-img-top diamond-image" src="${diamond.imageDiamond}" alt="Diamond image">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${diamond.diamondName}</h5>
                                <p class="card-text">Code: <strong>${diamond.code}</strong></p>
                                <p class="card-text">Trọng lượng: <strong>${diamond.carat} carat</strong></p>
                                <p class="card-text">Màu sắc: <strong>${diamond.color}</strong></p>
                                <p class="card-text">Độ tinh khiết: <strong>${diamond.clarity}</strong></p>
                                <p class="card-text">Chất lượng cắt: <strong>${diamond.cut}</strong></p>
                                <p class="card-text">Số lượng: <strong>${diamond.quantity}</strong></p>
                                <p class="card-text">Giá Bán: <strong>${diamond.price}</strong></p>
                                <div class="mt-auto d-flex justify-content-between">
                                    <a href="/Manager/Diamonds/EditDiamond?id=${diamond.id}" class="btn btn-outline-secondary btn-fw me-2">Cập Nhật</a>
                                    <a data-bs-toggle="modal" data-bs-target="#diamondModal-${diamond.id}" class="btn btn-outline-danger btn-fw">
                                        <i class="fa fa-eye menu-icon"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                diamondListContainer.innerHTML += diamondCard;
            });
        }

        function changePage(page) {
            currentPage = page;
            fetchDiamonds();
        }

        document.addEventListener("DOMContentLoaded", () => {
            fetchDiamonds(1, 12); // Load the first page initially
        });

    </script>
}
    <style>
        .page-title {
            font-size: 2.5rem;
        }

    .card {
        margin-bottom: 20px;
    }

    .diamond-card {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .card-img-top {
        max-height: 200px;
        object-fit: cover;
    }

    .diamond-details {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .diamond-image {
        max-width: 300px;
        max-height: 300px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .diamond-info {
        width: 100%;
    }

        .diamond-info p {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            margin-bottom: 10px;
        }

            .diamond-info p strong {
                color: #495057;
            }

    .form-label {
        font-weight: bold;
        color: #495057;
    }

    .form-control {
        border-radius: 0.375rem;
    }

    .btn-gradient-secondary {
        background: linear-gradient(45deg, #6a11cb 0%, #2575fc 100%);
        border: none;
        color: white;
    }

    .bg-light {
        background-color: #f8f9fa !important;
    }

    .rounded {
        border-radius: 0.375rem !important;
    }

    .shadow-sm {
        box-shadow: 0 .125rem .25rem rgba(0, 0, 0, 0.075) !important;
    }

    .text-danger {
        font-size: 0.875rem;
    }

        .autocomplete {
            position: relative;
            display: inline-block;
        }

        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #ffffff;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
        }

        .autocomplete-item {
            display: flex;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            background-color: #fff;
            border-bottom: 1px solid #d4d4d4;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

            .autocomplete-item:hover {
                background-color: #e9e9e9;
            }

        .diamond-image-search {
            max-width: 50px;
            max-height: 50px;
            margin-right: 10px;
            border-radius: 5px;
            object-fit: cover;
        }

        .diamond-details -search
        display: flex;
        flex-direction: column;
        }

        .diamond-name-search {
            font-size: 1rem;
            margin: 0;
            font-weight: bold;
        }

        .diamond-code-search {
            font-size: 0.875rem;
            margin: 0;
            color: #495057;
        }
    </style>
